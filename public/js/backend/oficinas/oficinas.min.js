var _dialog_msg = null;
var _dialog_msg_consulta = null;
$(function () {
    $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
    });
    function callBackSearch(){
        if(_dialog_msg != null){
            _dialog_msg.close();
        }
    }
    var table = $('#oficinas-table').DataTable({
        processing: true,
        serverSide: true,
        responsive: true,
        lengthMenu: [30,60,90,120],
        language: {
            "lengthMenu": "_MENU_ por p치gina",
            "zeroRecords": "No hay resultados",
            "info": "mostrando p치gina _PAGE_ de _PAGES_",
            "infoEmpty": "No hay registros disponibles",
            "infoFiltered": "(filtrando de _MAX_ registros totales)",
            "search": "Buscar",
            "paginate": {
                first:      "Primera",
                previous:   "Anterior",
                next:       "Siguiente",
                last:       "Ultima"
            },
        },
        scrollX: true,
        ajax: {
            url: "/oficina",
        },
        columns: [
            {data: 'id', name: 'id'},
            {data: 'denominacion', name: 'denominacion'},
            {data: 'localidad', name: 'localidad'},
            {data: function(d){
                return (d.visibilidad_web == 1 ? 'SI' : 'NO')
            }, name:'visibilidad_web'},
            {data: 'action', name: 'action', orderable: false, searchable: false},
        ],
        columnDefs: [
        ],
        drawCallback: function( settings ) {
            $('#registros').html(settings.json.recordsFiltered);
            $('#total').html(settings.json.recordsTotal);
            callBackSearch();
        }
    });
    $('body').on('click', '.eliminarOficina', function () {
        var product_id = $(this).data("id");
        console.log($(this).data("id"));
        $.confirm({
            title: 'Advertencia',
            content: 'Desea eliminar la oficina seleccionada?- Recuerde que eliminar치 todos los turnos asociados a esta y su agenda activa',
            icon: 'mdi mdi-alert-circle '+'red',
            buttons: {
                aceptar: {
                    text: 'Eliminar',
                    btnClass: 'btn-success',
                    keys: ['enter', 'shift'],
                    action :function () {
                        $.ajax({
                            url: "oficina/eliminar/"+product_id,
                            method: 'DELETE',
                        }).done(function(data) {
                            if(data.status == 'success'){
                                showMsg('Informaci칩n!', data.msg,'green');
                                table.draw();
                            }else{
                                showMsg('Advertencia!', data.msg,'red');
                            }
                        });
                    }
                },
                cancelar: {
                    text: 'Cancelar',
                    btnClass: 'btn-danger',
                    keys: ['enter', 'shift'],
                    action: function () {
                    
                    }
                },
                
            },
            
        });
    });
});