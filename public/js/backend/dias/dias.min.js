var _dialog_msg = null;
var _dialog_msg_consulta = null;
$(function () {
    $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
    });
    function callBackSearch(){
        if(_dialog_msg != null){
            _dialog_msg.close();
        }
    }
    var table = $('#dias-table').DataTable({
        processing: true,
        serverSide: true,
        responsive: true,
        lengthMenu: [30,60,90,120],
        language: {
            "lengthMenu": "_MENU_ por página",
            "zeroRecords": "No hay resultados",
            "info": "mostrando página _PAGE_ de _PAGES_",
            "infoEmpty": "No hay registros disponibles",
            "infoFiltered": "(filtrando de _MAX_ registros totales)",
            "search": "Buscar",
            "paginate": {
                first:      "Primera",
                previous:   "Anterior",
                next:       "Siguiente",
                last:       "Ultima"
            },
        },
        scrollX: true,
        ajax: {
            url: "/dias",
        },
        columns: [
            {data: 'id', name: 'id'},
            {data: 'fecha', name: 'fecha'},
            {data: 'descripcion', name: 'descripcion'},
            {data: 'action', name: 'action', orderable: false, searchable: false},
        ],
        columnDefs: [
        ],
        drawCallback: function( settings ) {
            $('#registros').html(settings.json.recordsFiltered);
            $('#total').html(settings.json.recordsTotal);
            callBackSearch();
        }
    });
    $('body').on('click', '.eliminarDia', function () {
        var product_id = $(this).data("id");
        console.log($(this).data("id"));
        $.confirm({
            title: 'Advertencia',
            content: 'Desea eliminar el día seleccionado?',
            icon: 'mdi mdi-alert-circle '+'red',
            buttons: {
                aceptar: {
                    text: 'Eliminar',
                    btnClass: 'btn-success',
                    keys: ['enter', 'shift'],
                    action :function () {
                        $.ajax({
                            url: "dias/eliminar/"+product_id,
                            method: 'DELETE',
                        }).done(function(data) {
                            if(data.status == 'success'){
                                showMsg('Información!', data.msg,'green');
                                table.draw();
                            }else{
                                showMsg('Advertencia!', data.msg,'red');
                            }
                        });
                    }
                },
                cancelar: {
                    text: 'Cancelar',
                    btnClass: 'btn-danger',
                    keys: ['enter', 'shift'],
                    action: function () {
                    
                    }
                },
                
            },
            
        });
    });
});